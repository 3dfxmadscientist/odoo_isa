<?xml version="1.0" encoding="utf-8" ?>
<openerp>
    <data>

        <record model="ir.ui.view" id="call_center_manager_form_view">
            <field name="name">Call Routing Form</field>
            <field name="model">project.issue</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Call Routing Form">
                    <group colspan="4" col="6">
                        <group colspan="2" col="4">
                            <field name="ticket_id" readonly="1"/>
                            <field name="date_open" readonly="1"/>
                        </group>
                    <field name="name" attrs="{'readonly':[('state','!=','draft')]}"/>
                    <field name="user_id" readonly="1"/>
                    <field name="project_id" required="True" attrs="{'readonly':[('state','not in',('open','draft','pending','reject',))]}"/>
                    <field name="priority" required="True" attrs="{'readonly':[('state','not in',('open','draft','pending','reject',))]}"/>
                    <field name="assigned_to_temp" attrs="{'readonly':[('state','not in',('open','draft','pending','reject',))]}"/>
                    </group>
                    <notebook colspan="4">
                        <page string="General">
                            <group col="4" colspan="2">
                                <separator colspan="4" string="Communication"/>
                                <group col="2" colspan="2">
                                <field name="partner_id" attrs="{'readonly':[('state','!=','draft')]}" on_change="onchange_partner_id(partner_id, email_from)"/>
                                <field name="partner_address_id" attrs="{'readonly':[('state','!=','draft')]}" string="Contact" on_change="onchange_partner_address_id(partner_address_id, email_from)"/>
                                </group>
                                <group col="2" colspan="2">
                                <field name="partner_phone" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="email_from" attrs="{'readonly':[('state','!=','draft')]}"/>
                                </group>
                            </group>
                            <group col="4" colspan="2">
                                <separator colspan="4" string="Ticket Contact"/>
                                <field name="name_contact" colspan="2" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="phone_contact" colspan="2" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <field name="mail_contact" colspan="4" attrs="{'readonly':[('state','!=','draft')]}"/>
                            </group>
                            <separator string= "Description" colspan="4" />
                            <field name="description" nolabel="1" colspan="4" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <separator colspan="4"/>
                            <group col="8" colspan="4">
                            <field name="state" />
                            <button name="case_open_and_assigns" string="Open and assigns" states="draft" type="object" icon="gtk-go-forward"/>
                            <button name="case_assign" string="Assign" states="open,pending" type="object" icon="gtk-go-forward"/>
                            <button name="%(call_center.action_call_center_refuse)d" string="Refuse" states="open,pending" type="action" icon="gtk-cancel"/>
                            <button name="case_pending" string="Pending" states="open" type="object" icon="gtk-media-pause"/>
                            <button name="case_assign" string="Assign to other user" states="reject" type="object" icon="gtk-go-forward"/>
                            </group>
                        </page>
                        <page string="Communication &amp; History" groups="base.group_extended">
                            <field name="message_ids" colspan="4" nolabel="1" mode="tree,form" attrs="{'readonly':[('state','in',['done','refuse',])],}" >
                                <tree string="History">
                                    <field name="display_text" string="History Information"/>
                                    <field name="history" invisible="1"/>
                                </tree>
                                <form string="History">
                                    <group col="4" colspan="4">
                                        <field name="date"/>
                                        <field name="name" colspan="4" widget="char" size="512"/>
                                        <field name="history" invisible="1"/>
                                    </group>
                                    <notebook colspan="4">
                                        <page string="Details">
                                            <group attrs="{'invisible': [('history', '!=', True)]}">
                                                <field name="description" colspan="4" nolabel="1" height="250"/>
                                            </group>
                                            <group attrs="{'invisible': [('history', '=', True)]}">
                                                <field name="display_text" colspan="4" nolabel="1"  height="250"/>
                                            </group>
                                        </page>
                                        <page string="Attachments">
                                            <field name="attachment_ids" colspan="4" readonly="1" nolabel="1"/>
                                        </page>
                                    </notebook>
                                </form>
                            </field>
                           <separator colspan="4"/>
                            <button string="Add Internal Note"
                                name="%(crm.action_crm_add_note)d"
                                context="{'model': 'crm.lead' }"
                                attrs="{'readonly':[('state','in',['done','refuse',])],}"
                                icon="terp-document-new" type="action" />
                        </page>
                           <page string="Extra Info" groups="base.group_extended">
                            <group col="2" colspan="2">
                            <separator colspan="2" string="Date"/>
                            <field name="create_date"/>
                            <field name="write_date" />
                            <field name="date_closed"/>
                            <!--<field name="date_open"/>-->
                            </group>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="call_center_manager_tree_view">
            <field name="name">Call Routing Tree</field>
            <field name="model">project.issue</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Call Routing Tree" colors="black:state in ('draft', 'open', 'pending');cyan:state=='process';blue:state=='assign';red:state=='reject';green:state=='done';grey:state in ('cancel', 'refuse')">
                    <field name="ticket_id"/>
                    <field name="date_open"/>
                    <field name="name"/>
                    <field name="partner_id" groups="base.group_extended"/>
                    <field name="project_id" />
                    <field name="priority"/>
                    <field name="user_id"/>
                    <field name="assigned_to"/>
                    <field name="progress" widget="progressbar" attrs="{'invisible':[('task_id','=',False)]}"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="view_call_center_manager_filter">
            <field name="name">Call Routing Search</field>
            <field name="model">project.issue</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Call Search">
                    <group>
                        <filter string="Current" name="current" domain="[('state','in',('draft','open','pending','reject'))]" help="Draft, To Do and Rejected" icon="terp-check"/>
                        <filter string="To Do" name="todo" domain="[('state','in',('open','reject'))]" help="To Do Calls" icon="terp-camera_test"/>
                        <filter string="Pending" domain="[('state','=','pending')]"  help="Pending Calls" icon="terp-gtk-media-pause"/>
                        <filter string="In progress" domain="[('state','=','process')]"  help="Calls in progress" icon="gtk-execute"/>
                        <filter string="Completed" domain="[('state','=','done')]"  help="Completed Calls" icon="terp-locked"/>
                        <separator orientation="vertical"/>
                        <!--<filter icon="terp-go-today" string="Today" separator="1" domain="[('date_open','&gt;=',time.strftime('%%Y-%%m-%%d')),('date_open','&lt;', (datetime.date.today() + datetime.timedelta (days = 1)).strftime('%%Y-%%m-%%d'))]" help="Today's calls" />-->
                        <separator orientation="vertical"/>
                        <field name="name" select='1'/>
                        <field name="partner_id" select="1"/>
                        <field name="user_id">
                            <filter domain="[('user_id','=',False)]"  help="Unassigned Calls" icon="terp-personal-" separator="1"/>
                        </field>
                        <field name="project_id"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended Filters..."  groups="base.group_extended">
                        <field name="state" />
                        <separator orientation="vertical"/>
                        <field name="date_open"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By..."  groups="base.group_extended">
                        <filter string="Responsible" icon="terp-personal" domain="[]" context="{'group_by':'user_id'}" />
                        <filter string="Assigned to" icon="terp-personal" domain="[]" context="{'group_by':'assigned_to'}" />
                        <separator orientation="vertical"/>
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'partner_id'}" />
                        <separator orientation="vertical"/>
                        <filter string="Project"  icon="terp-folder-violet" domain="[]" context="{'group_by':'project_id'}" />
                        <separator orientation="vertical"/>
                        <filter string="Priority" icon="terp-rating-rated" domain="[]" context="{'group_by':'priority'}" />
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}" />
                        <separator orientation="vertical" />
                        <filter string="Month" icon="terp-go-month" domain="[]" context="{'group_by':'date_open'}" help="Month in which it was open"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_open_call_center_manager">
            <field name="name">Call Center - Call Routing</field>
            <field name="res_model">project.issue</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="view_id" ref="call_center_manager_form_view"/>
            <field name="search_view_id" ref="view_call_center_manager_filter"/>
            <field name="domain">[('ticket_id','!=',False)]</field>
            <field name="context">{"search_default_current":1}</field>
            <field name="help">Call Routing</field>
        </record>
        
        <record model="ir.actions.act_window.view" id="action_open_call_center_manager_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="call_center_manager_tree_view"/>
            <field name="act_window_id" ref="action_open_call_center_manager"/>
        </record>
        
        <record model="ir.actions.act_window.view" id="action_open_call_center_manager_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="call_center_manager_form_view"/>
            <field name="act_window_id" ref="action_open_call_center_manager"/>
        </record>
        
        <menuitem name="Call Routing" parent="menu_open_call_center" id="menu_call_routing"
             action="action_open_call_center_manager" groups = "call_center.call_center_tm_mgr"/>
             
    </data>
</openerp>

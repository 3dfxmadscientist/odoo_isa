<?xml version="1.0"?>
<openerp>
    <data>
        
        <record model="ir.ui.view" id="call_center_form_view">
            <field name="name">Ticket Form</field>
            <field name="model">crm.claim</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Calls">
                    <group colspan="4">
                        <field name="ticket_id" readonly="True" />
                        <field name="date" readonly="True"/>
                        <field name="name" attrs="{'readonly':[('state','not in',('draft',))]}"/>
                        <field name="priority" attrs="{'readonly':[('state','not in',('draft',))]}"/>
                    </group>
                    <group colspan="4">
                        <notebook>
                            <page string="Claim Description">
                                 <group col="4" colspan="2">
                                    <separator colspan="4" string="Communication"/>
                                    <group col="2" colspan="2">
                                    <field name="partner_id" attrs="{'readonly':'True'}" on_change="onchange_partner_id(partner_id, email_from)"/>
                                    <field name="partner_address_id" attrs="{'readonly':'True'}" string="Contact" on_change="onchange_partner_address_id(partner_address_id, email_from)"/>
                                    </group>
                                    <group col="2" colspan="2">
                                    <field name="partner_phone" attrs="{'readonly':'True'}"/>
                                    <field name="email_from" attrs="{'readonly':'True'}"/>
                                    </group>
                                </group>
                                <group col="4" colspan="2">
                                    <separator colspan="4" string="Ticket Contact"/>
                                    <field name="name_contact" colspan="2" attrs="{'readonly':[('state','!=','draft')]}"/>
                                    <field name="phone_contact" colspan="2" attrs="{'readonly':[('state','!=','draft')]}"/>
                                    <field name="mail_contact" colspan="4" attrs="{'readonly':[('state','!=','draft')]}"/>
                                </group>
                                <separator colspan="4" string="Claim/Action Description"/>
                                <field name="description" colspan="4" nolabel="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                                <separator colspan="4" string=""/>
                                <group col="8" colspan="4">
                                    <field name="state" select="1" />
                                    <button name="case_open" string="Open"
                                        states="draft,pending" type="object"
                                        icon="gtk-go-forward" />
                                </group>
                            </page>
                            
                            <page string="Communication &amp; History" groups="base.group_extended">
                                <field name="message_ids" colspan="4" nolabel="1" mode="tree,form" attrs="{'readonly':[('state','in',['done','refuse',])],}">
                                    <tree string="History">
                                        <field name="display_text" string="History Information"/>
                                    </tree>
                                    <form string="Communication &amp; History">
                                        <group col="4" colspan="4">
                                            <!--field name="email_from"/-->
                                            <field name="date"/>
                                            <!--field name="email_to" widget="char" size="512"/-->
                                            <!--field name="email_cc" widget="char" size="512"/-->
                                            <field name="name" colspan="4" widget="char" size="512"/>
                                            <field name="history" invisible="1"/>
                                        </group>
                                        <notebook colspan="4">
                                            <page string="Details">
                                                <group attrs="{'invisible': [('history', '!=', True)]}">
                                                    <field name="description" colspan="4" nolabel="1" height="250"/>
                                                    <!--button colspan="4"
                                                        string="XXReply"
                                                        name="%(crm.action_crm_send_mail)d"
                                                        context="{'mail':'reply', 'model': 'crm.claim', 'include_original' : True}"
                                                        icon="terp-mail-replied" type="action" /-->
                                                </group>
                                                <group attrs="{'invisible': [('history', '=', True)]}">
                                                    <field name="display_text" colspan="4" nolabel="1"  height="250"/>
                                                </group>
                                            </page>
                                            <page string="Attachments">
                                                <field name="attachment_ids" colspan="4" readonly="1" nolabel="1"/>
                                            </page>
                                        </notebook>
                                    </form>
                                </field>
                                <button string="Add Internal Note"
                                    name="%(crm.action_crm_add_note)d"
                                    context="{'model': 'crm.lead' }"
                                    attrs="{'readonly':[('state','in',['done','refuse',])],}"
                                    icon="terp-document-new" type="action" />
                            </page>
                        </notebook>
                    </group>
                </form>
            </field>
        </record>
        
        <record model="ir.ui.view" id="call_center_tree_view">
            <field name="name">Ticket Tree</field>
            <field name="model">crm.claim</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Tickets" colors="black:state in ('draft', 'open', 'pending');cyan:state=='process';blue:state=='assign';red:state=='reject';green:state=='done';grey:state in ('cancel', 'refuse')">
                    <field name="partner_id" invisible="1" groups="base.group_extended"/>
                    <field name="ticket_id"/>
                    <field name="date"/>
                    <field name="name"/>
                    <field name="priority"/>
                    <field name="description"/>
                    <field name="date_closed" invisible="1"/>
                    <field name="state"/>
                </tree>
            </field>
        </record>

        <record id="view_call_center_filter" model="ir.ui.view">
            <field name="name">Call Center Ticket Search</field>
            <field name="model">crm.claim</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Call Search">
                    <group>
                        <filter icon="terp-check" string="Current" name="current" domain="[('state','in',('draft', 'open','pending'))]" separator="1" help="Draft and Open Ticket" />
                        <filter string="Assigned" domain="[('state','=','assign')]" help="Assigned Tickets" icon="terp-camera_test"/>
                        <filter string="In progress" domain="[('state','=','process')]"  help="Tickets in progress" icon="gtk-execute"/>
                        <filter string="Completed" domain="[('state','=','done')]"  help="Completed Tickets" icon="terp-locked"/>
                        <filter string="Refused" domain="[('state','=','refuse')]"  help="Refused Tickets" icon="terp-gdu-smart-failing"/>
                        <separator orientation="vertical"/>
                        <field name="name" select='1'/>
                        <field name="partner_id" select="1"/>
                        <field name="user_id">
                            <filter domain="[('user_id','=',False)]"  help="Unassigned Calls" icon="terp-personal-" separator="1"/>
                        </field>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended Filters..."  groups="base.group_extended">
                        <field name="state" />
                        <separator orientation="vertical"/>
                        <field name="date"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Partner" icon="terp-partner"
                            domain="[]" help="Partner"
                            context="{'group_by':'partner_id'}" />
                        <separator orientation="vertical"/>
                        <filter string="State"
                            icon="terp-stock_effects-object-colorize"
                            domain="[]" context="{'group_by':'state'}" />
                        <separator orientation="vertical"/>
                        <filter string="Claim Date" icon="terp-go-month"
                            domain="[]" help="Claim Date"
                            context="{'group_by':'date'}" />
                        <filter string="Closure" icon="terp-go-month"
                            domain="[]" help="Date Closed"
                            context="{'group_by':'date_closed'}" />
                    </group>
                </search>
            </field>
        </record>
        
        
        <menuitem
            name="Call Center"
            parent=""
            id="menu_open_call_center" groups = ""
            sequence="5"
            web_icon="images/callcenter.png" 
            web_icon_hover="images/callcenter-hover.png" />
            
            
        <record model="ir.actions.act_window" id="action_open_call_center">
            <field name="name">Call Center - Ticket Open</field>
            <field name="res_model">crm.claim</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="view_id" ref="call_center_form_view"/>
            <field name="search_view_id" ref="view_call_center_filter"/>
            <field name="domain">[('ticket_id','!=',False)]</field>
            <field name="context">{"search_default_user_id":uid, "search_default_current":1}</field>
            <field name="help">Ticket Open</field>
        </record>
        
        <record model="ir.actions.act_window.view" id="action_open_call_center_tree">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="call_center_tree_view"/>
            <field name="act_window_id" ref="action_open_call_center"/>
        </record>
        
        <record model="ir.actions.act_window.view" id="action_open_call_center_form">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="call_center_form_view"/>
            <field name="act_window_id" ref="action_open_call_center"/>
        </record>
        
        <menuitem name="Ticket Open" parent="menu_open_call_center" id="menu_ticket_open"
             action="action_open_call_center" groups = "call_center.call_center_ex_to"/>

    </data>
</openerp>
